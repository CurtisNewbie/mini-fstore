# API Endpoints

- GET /file/stream
  - Description: Media streaming using temporary file key, the file_key's ttl is extended with each subsequent request. This endpoint is expected to be accessible publicly without authorization, since a temporary file_key is generated and used.
  - Query Parameter: "key"
    - Description: temporary file key
- GET /file/raw
  - Description: Download file using temporary file key. This endpoint is expected to be accessible publicly without authorization, since a temporary file_key is generated and used.
  - Query Parameter: "key"
    - Description: temporary file key
- PUT /file
  - Description: Upload file. A temporary file_id is returned, which should be used to exchange the real file_id
  - Header Parameter: "filename"
    - Description: name of the uploaded file
  - JSON Response:
    - "errorCode": (string) error code
    - "msg": (string) message
    - "error": (bool) whether the request was successful
    - "data": (string) response data
- GET /file/info
  - Description: Fetch file info
  - Query Parameter: "uploadFileId"
    - Description: temporary file_id returned when uploading files
  - Query Parameter: "fileId"
    - Description: actual file_id of the file record
  - JSON Response:
    - "errorCode": (string) error code
    - "msg": (string) message
    - "error": (bool) whether the request was successful
    - "data": (FstoreFile) response data
      - "id": (int64) 
      - "fileId": (string) 
      - "name": (string) 
      - "status": (string) 
      - "size": (int64) 
      - "md5": (string) 
      - "uplTime": (int64) 
      - "logDelTime": (int64) 
      - "phyDelTime": (int64) 
- GET /file/key
  - Description: Generate temporary file key for downloading and streaming. This endpoint is expected to be called internally by another backend service that validates the ownership of the file properly.
  - Query Parameter: "fileId"
    - Description: actual file_id of the file record
  - Query Parameter: "filename"
    - Description: the name that will be used when downloading the file
  - JSON Response:
    - "errorCode": (string) error code
    - "msg": (string) message
    - "error": (bool) whether the request was successful
    - "data": (string) response data
- GET /file/direct
  - Description: Download files directly using file_id. This endpoint is expected to be protected and only used internally by another backend service. Users can eaily steal others file_id and attempt to download the file, so it's better not be exposed to the end users.
  - Query Parameter: "fileId"
    - Description: actual file_id of the file record
- DELETE /file
  - Description: Mark file as deleted.
  - Query Parameter: "fileId"
    - Description: actual file_id of the file record
- POST /file/unzip
  - Description: Unzip archive, upload all the zip entries, and reply the final results back to the caller asynchronously
  - JSON Request:
    - "fileId": (string) file_id of zip file
    - "replyToEventBus": (string) name of the rabbitmq exchange to reply to, routing_key is '#'
    - "extra": (string) extra information that will be passed around for the caller
- POST /backup/file/list
  - Description: Backup tool list files
  - Header Parameter: "Authorization"
    - Description: Basic Authorization
  - JSON Request:
    - "limit": (int64) 
    - "idOffset": (int) 
- GET /backup/file/raw
  - Description: Backup tool download file
  - Header Parameter: "Authorization"
    - Description: Basic Authorization
  - Query Parameter: "fileId"
    - Description: actual file_id of the file record
- POST /maintenance/remove-deleted
  - Description: Remove files that are logically deleted and not linked (symbolically)
- POST /maintenance/sanitize-storage
  - Description: Sanitize storage, remove files in storage directory that don't exist in database
- GET /auth/resource
- GET /metrics
  - Description: Collect prometheus metrics information
  - Header Parameter: "Authorization"
    - Description: Basic authorization if enabled
- GET /doc/api
  - Description: Serve the generated API documentation webpage